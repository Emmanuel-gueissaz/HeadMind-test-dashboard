<template lang="pug">
q-card.col-12.line-border( flat square)
  q-card-section
    .row.items-center.full-width
      .col.row
        q-badge(:label='props.vulnerability.id' color='grey-9')
        .text-bold.q-ml-sm {{props.vulnerability.description}}
      .col-auto
        q-chip.text-uppercase(:label='t(`severity.${props.vulnerability.severity}`)' outline :style='`color:#${severityColor(props.vulnerability.severity)}`')
    .row.items-center.justify-between(style='width:80%')
      .row.items-center
        q-icon.col-auto(name='computer' color='primary')
        .text-caption.col.q-pl-xs {{props.vulnerability.system}}
      .text-caption CVSS : {{props.vulnerability.cvssScore}}
      .col-2
        q-select(v-if='user.user?.isAdmin',
        :model-value='props.vulnerability.status'
        @update:modelValue='v =>{ props.vulnerability.status = v; updateStatus(props.vulnerability)}'
        :options='cumputedStatus',
        option-label='label'
        option-value='value'
        emit-value
        outlined
        dense
        :style='`background:#${statusColor(props.vulnerability.status)}`'
        )
        q-badge(v-else :label='t(`status.${props.vulnerability.status}`)' outline :style='`color:#${statusColor(props.vulnerability.status)}`')

</template>
<script setup lang="ts">
// Components
// Interfaces
import type { IVulnerability } from 'src/interfaces/IVulnerability.model';
import { Status } from 'src/interfaces/TStatus.model';
import { useVulnerabilityStore } from 'src/stores/vulnerability';
// Stores
import { useUserStore } from 'src/stores/user';
// Library
import { useI18n } from 'vue-i18n';
import { computed } from 'vue';
import { Notify } from 'quasar';
// Others
import { severityColor, statusColor } from 'src/helpers'; // eslint-disable-line

const {t} = useI18n()

// eslint-disable-next-line
const user = useUserStore()

const vulnerabilityStore = useVulnerabilityStore()

// eslint-disable-next-line
const props = defineProps<{
  vulnerability:IVulnerability,
}>()

// eslint-disable-next-line
const cumputedStatus = computed(() => Status.map(s => ({label:t(`status.${s}`), value:s})))

// eslint-disable-next-line
const updateStatus = (vulnerability:IVulnerability) => {
  vulnerabilityStore.update(vulnerability)
  Notify.create({message:t('success')})
}
</script>
<style lang="sass">
.line-border
  border-top: 1px solid #414B5C
</style>